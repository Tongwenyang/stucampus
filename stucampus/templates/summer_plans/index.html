<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<title>{{ plan_category.name }}【深大学子天地】</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<link href="/static/images/stulogo.png" type="image/x-icon" rel="shortcut icon" />
	{% load html_tools %}
	{% load date_tools %}<!-- #用于算出距离现在的时间间隔,并处理姓名，学号-->
	<link rel="stylesheet" href="/static/scripts/plugins/bootstrap2.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/scripts/plugins/bootstrap2.3.2/css/bootstrap-responsive.css">
	{{ 'summer_plans/index.css' | as_css }}


</head>
<body>
	<div id="user_id" class="hide">{{request.session.szu_no}}</div>
	<!-- 发表暑假计划的form Modal -->
	<div id="form_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h4 id="myModalLabel">发布你的{{ plan_category.name }}</h3>
		</div>
		<div class="modal-body">
			<p id="plan_form_error"></p>
			<form id="plan_form">
			{% csrf_token %}
			<p class="form_p"> <label for="id_content">计划:</label><textarea class="form-control" required="required" cols="40" id="id_content" name="content" placeholder="写下你的计划吧" rows="3" maxlength="1000"></textarea></p>
			{% if not user.email %}
			<p class="form_p">
				<label for="id_email">邮箱:</label><input required="required" class="form-control" id="id_email" name="email" placeholder="在假期过后，我们将通过邮箱提醒您" type="email">
			</p>
			{% endif %}
			<!-- <p class="form_p"></p> -->
			<p class="form_inline"><label for="id_is_anon">匿名:</label> <input id="id_is_anon" name="is_anon" type="checkbox"><span id="alias_box" class="visi_hide"><input id="id_alias" maxlength="10" name="alias" type="text" placeholder="昵称"></span></p>
			</form>				
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
			<button class="btn btn-primary" data-url="{% url 'summer_plans:add_plan' plan_category.english_name %}" id="submit_plan_form">Save</button>
		</div>
	</div>
	<!-- 发表暑假计划的form  Modal end-->

	<!-- 搜索（Modal） start -->
	<div id="search" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<form id="search_form" action="{% url 'summer_plans:search' plan_category.english_name %}" method="GET">
			<div class="modal-body">
				<p class="form_p">
					<label for="search_input">搜索:</label>
					<input id="search_input" type="text" required="required" name="q" placeholder="可模糊搜索发布内容，姓名或昵称，学院">
				</p>
			</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
			<button class="btn btn-primary" id="submit_search_form" type="submit">search</button>
		</div>
		</form>
	</div>
<!-- /搜索.modal end-->
<!-- 感悟 modal 由函数调用 start -->
	<div id="thought_modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="thought" aria-hidden="true">
		<div class="modal-body">
			<div class="row">
				<form id="thought_form">
					{% csrf_token %}
					<p id="thought_form_error"></p>
					<div class="col-xs-12 col-sm-12 modal_form_box">
						<p class="form_p">
							 <textarea class="form-control" cols="40" id="id_thought" name="thought" placeholder="写下你的感悟" rows="10" required="required" maxlength="1000"></textarea>
						</p>			
					</div>
				</form>
			</div>	
		</div>
		<div class="modal-footer">
			<button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
			<button class="btn btn-primary" data-url="" id="submit_thought_form" >Save</button>
		</div>
		
	</div>
<!-- 感悟.modal end-->
	<main class="container">
		<div >
			<div class="col-lg-12 col-sm-12 ">
				<header class="clearfix">	
					<div class="navbar clearfix">
						<span class="pull-left">
							<a href="/" class="logo">
								<img src="/static/images/stucampus_logo.png" alt="szulogo">
							</a>
							<a href="{% url 'summer_plans:list' plan_category.english_name %}" class="theme_title">{{ plan_category.name }}</a>
							<span class="theme_title">{{title}}</span>
						</span>	
						<span class="pull-right right_box">
						<a href="#search" data-toggle="modal" class="function_btn"><i class="icon-search my_icon"></i> </a>
						<!-- 下拉框 start-->
						<a id="dropdownMenu"  class="function_btn" data-toggle="dropdown">
							<i class="icon-align-justify my_icon" ></i>
						</a>
						<!-- 下拉按钮 -->
						<ul class="dropdown-menu pull-right" role="menu" 
						aria-labelledby="dropdownMenu">
							{% if not request.session.szu_no %}
							<li role="presentation">
								<a role="menuitem" tabindex="-1" href="{% url 'summer_plans:add_plan' plan_category.english_name %}"><i class="icon-upload"></i> 登录</a>
								<li role="presentation">
									<a role="menuitem" tabindex="-1" href="{% url 'summer_plans:like_ranking_list' plan_category.english_name %}">
									<i class="icon-hand-up"></i>点赞排行
									</a>
								</li>
							</li>
							{% else %}
							<li role="presentation">
								<a href="#form_modal" class="form_modal_btn" tabindex="-1" role="button" class="btn" data-toggle="modal"><i class="icon-edit"></i> 发表计划
								</a>
							</li>
							<li role="presentation">
								<a role="menuitem" tabindex="-1" href="{% url 'summer_plans:self_plan' plan_category.english_name request.session.szu_no %}"><i class="icon-user"></i> 我的计划</a>
							</li>
							<li role="presentation">
								<a role="menuitem" tabindex="-1" href="{% url 'summer_plans:like_ranking_list' plan_category.english_name %}">
									<i class="icon-hand-up"></i>点赞排行
								</a>
							</li>
							<li role="presentation">
								<a role="menuitem" tabindex="-1" href="{% url 'summer_plans:logout' plan_category.english_name %}"><i class="icon-off"></i> 登出</a>
							</li>
							{% endif %}
							{% if perms.summer_plans.send_email %}
							<li role="presentation">
								<a role="menuitem" tabindex="-1" href="{% url 'summer_plans:senf_email_to_plan_author' plan_category.english_name %}"><i class="icon-envelope"></i> 发送邮件通知</a>
							</li>
							{% endif %}
							
							

						</ul>
						<!-- 下拉框 end-->
						</span>
					</div>
					
				</header>
				<div class="plan_list">
					<ul>
						{% if not plan_list %}
						<li class="plan_li">
							<p class="tip">没有相关信息</p>
						</li>
						{% endif %}
						{% for plan in plan_list %}
						<li class="plan_li">
							{% if plan.author.is_anon %}
							<p class="plan_author"><span class="show_last_name" style="background-color: {{ plan.author.get_avatar_color_display  }};">匿</span><span class="author_name">{{ plan.author.alias }}</span></p>
							{% else %}
							<p class="plan_author"><span class="show_last_name" style="background-color: {{ plan.author.get_avatar_color_display  }};">{{ plan.author.szu_name|show_last_name }}</span><span class="author_name">{{ plan.author.szu_name }}</span></p>
							{% endif %}

							<span class="author_szu_org">from: {{ plan.author.szu_org_name }}</span>
							<p class="plan_content">{{ plan.content }}</p>
							{% if plan.thought %} 
							<p class="plan_thought_box">
								<p class="thought_title">暑假过后:</p>
								<p class="plan_thought">{{ plan.thought }}</p>
							</p>
							{% endif %}
							<div class="function_wrapper clear-fixed">
								<span class="pull-left">
									<span class="create_time">{{ plan.create_date |from_now }}</span>
									{% ifequal plan.author.szu_no request.session.szu_no %}
									<a class="delete_btn" href="{% url 'summer_plans:delete' plan_category.english_name plan.pk %}">删除</a>
									{% endifequal %}
								</span>
								<span class="right_box pull-right">
									{% if plan_category.tip_time|time_to_on and plan.author.szu_no == request.session.szu_no %}
									<a class="post_thought" href="javascript:void(0);" data-url="{% url 'summer_plans:post_thought' plan_category.english_name plan.pk %}">发表感想</a>

									{% endif %}
									<span id="liked_tip{{plan.pk}}" class="liked_tip {% if request.session.szu_no not in plan.like_persons.all|show_szu_no %} visi_hide {% endif %}">已赞</span>
									
									<img  class="loading visi_hide" id="like_loading{{plan.pk}}" src="/static/images/summer_plans/loading.gif" alt="loading">
									
									<span class="like_btn" data-url="{% url 'summer_plans:like' plan_category.english_name %}?plan_id={{plan.pk}}" data-plan_id="{{ plan.pk }}"><i class="icon-thumbs-up"></i></span>
								</span>
							</div>
							
							<div class="like_persons_wrapper {% if not plan.like_persons.all %} hide {% endif %}" id="like_persons_wrapper{{plan.pk}}">
								<img src="/static/images/summer_plans/l.png" alt="love" width="15px" height="15px;">
								<span class="like_persons" id="like_persons{{plan.pk}}">{{ plan.like_persons.all|show_name }}</span>
							</div>
							
						</li>
						{% endfor %}
					

						{% if plan_list.has_next %}
						<div class="page_number">{{ plan_list.number }}</div>
						{% else %}
						<div class="page_number no_more_tip">没有更多了</div>
						{% endif %} 
 						
					</ul>
					<div id="loading_plan_list" class="hide">
	        			<img src="/static/images/summer_plans/loading.gif" alt="loading">
	        		</div>
				</div>
			</div>
		</div>
	</main>
	{{ 'plugins/jquery.min.js' | as_js }}
	{{ 'plugins/bootstrap2.3.2/js/bootstrap.min.js' | as_js }}
	{{ 'summer_plans/index.js' | as_js }}
	<!-- 百度统计start -->
<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?4d0c962b688eb374c3f0a499db3087a4";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>
<!-- 百度统计end -->
</body>
</html>